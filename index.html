<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login</title>

<link rel="stylesheet" href="style.css">
</head>

<body>

<!-- LOGO -->
<div class="logo-container">
  <img src="images/Logo1.png" alt="Logo" class="logo-img">
</div>

<div class="login-container">
  <h2 style="color:white;">Login</h2>

  <form onsubmit="login(event)">
    <label>Username / Email</label>
    <input type="text" id="email" required>

    <label>Password</label>
    <input type="password" id="password" required>

    <button class="btn">Login</button>

    <p class="signup-link">
      Don't have an account?
      <a href="signup.html">Signup</a>
    </p>
  </form>

  <p id="error" style="color:red;"></p>
</div>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const SUPABASE_URL = "https://mcvfdjrbcwnfhrsuquil.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1jdmZkanJiY3duZmhyc3VxdWlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5MDg3MjgsImV4cCI6MjA4NDQ4NDcyOH0.HB-SFOE_XuZKXMn7gVzsO8EY9rgPpW9ws3m-QVS0lmI";

const supabase = supabase.createClient(
  SUPABASE_URL,
  SUPABASE_ANON_KEY
);

async function login(e){
  e.preventDefault();

  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;
  const error = document.getElementById("error");

  // ✅ ADMIN LOGIN (same logic as PHP)
  if(email === "admin@fitnesskulture.in" && password === "admin"){
    localStorage.setItem("role", "admin");
    window.location.href = "admin.html";
    return;
  }

  // 1️⃣ Supabase Auth login
  const { data, error: authError } = await supabase.auth.signInWithPassword({
    email,
    password
  });

  if(authError){
    error.innerText = authError.message;
    return;
  }

  // 2️⃣ Fetch user role/details
  const { data: userData, error: userError } = await supabase
    .from("users")
    .select("*")
    .eq("uid", data.user.id)
    .single();

  if(userError){
    error.innerText = userError.message;
    return;
  }

  // 3️⃣ Store session
  localStorage.setItem("user", JSON.stringify(userData));
  localStorage.setItem("role", userData.role);

  // 4️⃣ Redirect
  window.location.href = "home.html";
}
</script>

</body>
</html>
