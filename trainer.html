<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trainer Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  margin:0;
  background:#f4f4f4;
}
header {
  background:#333;
  color:white;
  padding:15px;
  text-align:center;
}
.container {
  max-width:1200px;
  margin:20px auto;
  background:white;
  padding:20px;
  border-radius:8px;
  box-shadow:0 2px 10px rgba(0,0,0,0.1);
}
h2 { margin-top:0 }
select, button {
  padding:8px;
  margin-top:10px;
}
ul {
  list-style:none;
  padding:0;
}
li {
  background:#fafafa;
  margin:10px 0;
  padding:10px;
  border-radius:5px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
.exercise {
  margin-left:20px;
  background:#fff;
  padding:8px;
}
@media(max-width:768px){
  .container { width:90% }
}
</style>
</head>

<body>

<header>
<h1>Trainer Dashboard</h1>
</header>

<div class="container">
<h2>Select a User</h2>
<select id="userSelect" onchange="loadUserData()"></select>
</div>

<div class="container">
<h2>BMI History</h2>
<canvas id="bmiChart" height="120"></canvas>
<p id="noBmi" style="color:red"></p>
</div>

<div class="container">
<h2>Custom Workouts</h2>
<div id="workoutList"></div>
</div>

<script>
/* ---------- DEMO DATA ---------- */
let users = JSON.parse(localStorage.getItem("users")) || [
  {uid:1, fullname:"John Doe"},
  {uid:2, fullname:"Jane Smith"}
];

let bmiHistoryByUser = JSON.parse(localStorage.getItem("bmiHistoryByUser")) || {
  1:[
    {date:"2024-01-01", bmi:24.1},
    {date:"2024-02-01", bmi:23.6}
  ],
  2:[
    {date:"2024-01-01", bmi:27.2}
  ]
};

let workoutsByUser = JSON.parse(localStorage.getItem("workoutsByUser")) || {
  1:[
    {
      workout_name:"Custom Workout 1",
      exercises:[
        {name:"Running", muscle:"Legs", intensity:"High", calories:300},
        {name:"Push Ups", muscle:"Chest", intensity:"Medium", calories:100}
      ]
    }
  ],
  2:[]
};

localStorage.setItem("users", JSON.stringify(users));
localStorage.setItem("bmiHistoryByUser", JSON.stringify(bmiHistoryByUser));
localStorage.setItem("workoutsByUser", JSON.stringify(workoutsByUser));

/* ---------- USER DROPDOWN ---------- */
const userSelect = document.getElementById("userSelect");
users.forEach(u=>{
  userSelect.innerHTML+=`<option value="${u.uid}">${u.fullname}</option>`;
});

/* ---------- LOAD USER DATA ---------- */
let chart;
function loadUserData(){
  const uid = userSelect.value;
  renderBMI(uid);
  renderWorkouts(uid);
}

/* ---------- BMI CHART ---------- */
function renderBMI(uid){
  const bmiData = bmiHistoryByUser[uid];
  const ctx = document.getElementById("bmiChart").getContext("2d");
  document.getElementById("noBmi").innerText="";

  if(chart) chart.destroy();

  if(!bmiData || bmiData.length===0){
    document.getElementById("noBmi").innerText="No BMI history available.";
    return;
  }

  chart = new Chart(ctx,{
    type:"line",
    data:{
      labels:bmiData.map(x=>x.date),
      datasets:[{
        label:"BMI",
        data:bmiData.map(x=>x.bmi),
        borderColor:"rgba(75,192,192,1)",
        backgroundColor:"rgba(75,192,192,0.2)",
        fill:true
      }]
    },
    options:{
      responsive:true,
      scales:{
        x:{title:{display:true,text:"Date"}},
        y:{title:{display:true,text:"BMI"}}
      }
    }
  });
}

/* ---------- WORKOUT LIST ---------- */
function renderWorkouts(uid){
  const list = document.getElementById("workoutList");
  list.innerHTML="";
  const workouts = workoutsByUser[uid];

  if(!workouts || workouts.length===0){
    list.innerHTML="<p>No custom workouts for this user.</p>";
    return;
  }

  workouts.forEach(w=>{
    let html = `<li><h3>${w.workout_name}</h3>`;
    w.exercises.forEach(e=>{
      html+=`
      <div class="exercise">
        Exercise: ${e.name}<br>
        Muscle Group: ${e.muscle}<br>
        Intensity: ${e.intensity}<br>
        Calories: ${e.calories}
      </div>`;
    });
    html+="</li>";
    list.innerHTML+=html;
  });
}

/* INITIAL LOAD */
loadUserData();
</script>

</body>
</html>
